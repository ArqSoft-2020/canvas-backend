<html>

<head>
    <title>Canvas MS</title>
    <script>
        
        //Class created to support the get request to update the drawing historial
        var HttpClient = function() {
            this.get = function(aUrl, aCallback) {
                var anHttpRequest = new XMLHttpRequest();
                anHttpRequest.onreadystatechange = function() {
                if (anHttpRequest.readyState == 4 && anHttpRequest.status == 200)
                    aCallback(anHttpRequest.responseText);
                }

                anHttpRequest.open( "GET", aUrl, true );
                anHttpRequest.send( null );
            }
        }

        //Update with historial info
        var client = new HttpClient();
        client.get('http://localhost:3000/api/canvas/historial/5e8fcd88f9dcbe2b703e447b', function(response) {
            response = JSON.parse(response)
            console.log(response);
            response.drawingHistorial.drawingHistorial.forEach(element => {
                var show = JSON.stringify(element);
                var inputCell = document.getElementById("input");
                inputCell.innerHTML = show + '<br />' + inputCell.innerHTML;
            });
        });

        //Assume that API service is published on same server that is the server of this HTML file
        var source = new EventSource("../api/canvas/update");
        source.onmessage = function (event) {
            var data = JSON.parse(event.data);
            if (data.evt_type == "drawing"){
                var show = {
                    coord_x: data.coord_x,
                    coord_y: data.coord_y,
                    color_r: data.color_r,
                    color_g: data.color_g,
                    color_b: data.color_b,
                }

                show = JSON.stringify(show);
                var inputCell = document.getElementById("input");
                inputCell.innerHTML = show + ', ' + inputCell.innerHTML;
            }else{
                var inputCell = document.getElementById("input");
                inputCell.innerHTML = '<div></div>';
            }
            
        };//onMessage
    </script>

</head>

<body>
    <h1>Canvas MicroService</h1>
    <br />
    <div id="input">
    </div>
</body>

</html>